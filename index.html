<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>A-Frame Table Scene — Corrected Tin Position</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <style>
    body { margin: 0; }
    .credits {
      position: absolute;
      left: 12px;
      bottom: 12px;
      color: #222;
      background: rgba(255,255,255,0.85);
      padding: 8px 10px;
      border-radius: 6px;
      font-family: Arial, sans-serif;
      font-size: 13px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="credits">Click an object to highlight it • Move with WASD / mouse</div>

  <a-scene background="color: #a6e1ff" shadow="type:PCFSoft" renderer="antialias: true">
    <a-sky color="#a6e1ff"></a-sky>

    <a-entity light="type: directional; intensity: 1.0; castShadow: true"
              position="-2 6 6"
              rotation="-50 -30 0"
              shadow="mapSizeWidth:2048; mapSizeHeight:2048; cameraLeft:-10; cameraRight:10; cameraTop:10; cameraBottom:-10">
    </a-entity>

    <a-entity light="type: ambient; color: #ffffff; intensity: 0.5"></a-entity>

    <a-plane rotation="-90 0 0" width="60" height="60" color="#75c25b" position="0 0 0" receive-shadow></a-plane>

    <a-entity id="table-group" position="0 0  -2">
      <a-cylinder id="table-top" radius="1.6" height="0.15" color="#b17540" position="0 0.85 0" rotation="0 0 0" segments-radial="48" shadow="cast: true; receive: true"></a-cylinder>
      <a-cylinder color="#8b562c" radius="0.08" height="1" position="-1.0 0.3 -0.8" rotation="0 0 0" shadow="cast:true"></a-cylinder>
      <a-cylinder color="#8b562c" radius="0.08" height="1" position="1.0 0.3 -0.8" rotation="0 0 0" shadow="cast:true"></a-cylinder>
      <a-cylinder color="#8b562c" radius="0.08" height="1" position="-0.6 0.3 0.9" rotation="0 0 0" shadow="cast:true"></a-cylinder>
      <a-cylinder color="#8b562c" radius="0.08" height="1" position="0.6 0.3 0.9" rotation="0 0 0" shadow="cast:true"></a-cylinder>
    </a-entity>

    <a-entity id="chair-left" position="-2.2 0 -1.6" rotation="0 22 0">
      <a-box width="1.0" height="0.45" depth="0.12" color="#8b5a2b" position="0 0.95 0.2" shadow="cast:true"></a-box>
      <a-box width="1.0" height="0.15" depth="1.0" color="#b17846" position="0 0.5 0" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="-0.42 0.25 -0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="0.42 0.25 -0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="-0.42 0.25 0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="0.42 0.25 0.4" shadow="cast:true"></a-box>
    </a-entity>

    <a-entity id="chair-right" position="2.2 0 -1.6" rotation="0 -22 0">
      <a-box width="1.0" height="0.45" depth="0.12" color="#8b5a2b" position="0 0.95 0.2" shadow="cast:true"></a-box>
      <a-box width="1.0" height="0.15" depth="1.0" color="#b17846" position="0 0.5 0" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="-0.42 0.25 -0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="0.42 0.25 -0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="-0.42 0.25 0.4" shadow="cast:true"></a-box>
      <a-box width="0.12" height="0.5" depth="0.12" color="#6b3f2b" position="0.42 0.25 0.4" shadow="cast:true"></a-box>
    </a-entity>
    
    <a-entity id="milo" position="-0.45 1.225 -2.12" rotation="0 0 0">
      <a-cylinder radius="0.28" height="0.6" color="#2f6b2e" segments-radial="36" shadow="cast:true"></a-cylinder>
      <a-cylinder radius="0.28" height="0.02" color="#758a2f" position="0 0.31 0"></a-cylinder>
      
      <a-entity text="value: MILO; color: #ffffff; align: center; width: 0.5; wrapCount: 8; rotation: -90 0 0" 
                position="0 0 0.29"> 
      </a-entity>
    </a-entity>

    <a-entity id="milk" position="0.55 1.225 -2.12">
      <a-cylinder radius="0.28" height="0.6" color="#ffffff" segments-radial="36" shadow="cast:true"></a-cylinder>
      <a-cylinder radius="0.28" height="0.02" color="#f0f0f5" position="0 0.31 0"></a-cylinder>
      
      <a-entity text="value: MILK; color: #2a5fc1; align: center; width: 0.5; wrapCount: 8; rotation: -90 0 0" 
                position="0 0 0.29">
      </a-entity>
    </a-entity>

    <a-entity id="cup1" position="-0.95 1.015 -1.9">
      <a-cylinder radius="0.14" height="0.18" color="#ffffff" segments-radial="24" position="0 0 0.0" shadow="cast:true"></a-cylinder>
      <a-cylinder radius="0.115" height="0.02" color="#f2f2f2" position="0 0.09 0"></a-cylinder>
    </a-entity>

    <a-entity id="cup2" position="0.95 1.015 -1.9">
      <a-cylinder radius="0.14" height="0.18" color="#ffffff" segments-radial="24" shadow="cast:true"></a-cylinder>
      <a-cylinder radius="0.115" height="0.02" color="#f2f2f2" position="0 0.09 0"></a-cylinder>
    </a-entity>

    <a-entity id="plant-left" position="-3.3 0 -0.6">
      <a-cylinder radius="0.25" height="0.5" color="#a65b3a" position="0 0.25 0"></a-cylinder>
      <a-sphere radius="0.55" color="#3fa44a" position="0 1.05 0" segments-width="18" segments-height="12" shadow="cast:true"></a-sphere>
    </a-entity>

    <a-entity id="plant-right" position="3.3 0 0.1">
      <a-cylinder radius="0.25" height="0.45" color="#a65b3a" position="0 0.225 0"></a-cylinder>
      <a-sphere radius="0.5" color="#3fa44a" position="0 0.95 0" shadow="cast:true"></a-sphere>
    </a-entity>

    <a-entity id="player"
              position="0 1.6 3.5"
              camera
              look-controls
              wasd-controls>
      <a-entity cursor="fuse: false; rayOrigin: mouse"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.008; radiusOuter: 0.014"
                material="color: white; shader: flat">
      </a-entity>
    </a-entity>

    <a-entity light="type: hemisphere; color:#fff; groundColor:#b6e19b; intensity:0.3"></a-entity>
    <a-entity id="invisible-pointer" visible="false"></a-entity>
    <a-entity id="script-root"></a-entity>

    <script>
      // Global variable to track the currently visible label entity
      let currentLabel = null;
      const LABEL_TIMEOUT = 2500; // 2.5 seconds visibility

      // Custom Component: Clicking pulses an object and shows a temporary label above it.
      AFRAME.registerComponent('click-pulse', {
        schema: { label: { type: 'string', default: '' } },
        init: function () {
          const el = this.el;

          const bbox = new THREE.Box3().setFromObject(el.object3D);
          const height = bbox.isEmpty() ? 0.3 : bbox.getSize(new THREE.Vector3()).y;
          const labelYOffset = height > 0 ? height + 0.15 : 0.8; 

          el.addEventListener('click', (evt) => {
            el.emit('pulse');
            
            if (currentLabel) {
              if (currentLabel.parentNode) {
                 currentLabel.parentNode.removeChild(currentLabel);
              }
              currentLabel = null;
            }

            currentLabel = document.createElement('a-entity');
            
            currentLabel.setAttribute('text', {
              value: this.data.label,
              color: '#000000',
              align: 'center',
              width: 0.6, 
              wrapCount: 20,
              backgroundColor: '#ffffff', 
              shader: 'msdf', 
              opacity: 1.0 
            });
            
            currentLabel.setAttribute('position', `0 ${labelYOffset} 0`);
            currentLabel.setAttribute('look-at', '#player');

            el.appendChild(currentLabel);

            setTimeout(()=> {
              if (currentLabel && currentLabel.parentNode === el) {
                el.removeChild(currentLabel);
                currentLabel = null;
              }
            }, LABEL_TIMEOUT);
          });

          el.setAttribute('animation__pulse', {
            property: 'scale',
            startEvents: 'pulse',
            dir: 'alternate',
            dur: 220,
            from: '1 1 1',
            to: '1.12 1.12 1.12',
            easing: 'easeOutQuad'
          });
        }
      });

      // Attach click-pulse component to interactive objects
      document.addEventListener('DOMContentLoaded', () => {
        const items = [
          {sel:'#milo', label:'MiLo Tin'},
          {sel:'#milk', label:'Milk Tin'},
          {sel:'#cup1', label:'Cup 1'},
          {sel:'#cup2', label:'Cup 2'},
          {sel:'#chair-left', label:'Left Chair'},
          {sel:'#chair-right', label:'Right Chair'},
          {sel:'#table-group', label:'Wooden Table'}
        ];
        items.forEach(it => {
          const el = document.querySelector(it.sel);
          if (el) el.setAttribute('click-pulse', 'label', it.label);
        });
      });
    </script>
  </a-scene>
</body>
</html>